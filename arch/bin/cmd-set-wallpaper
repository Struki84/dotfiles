#!/bin/bash
if ! pgrep -x "hyprpaper" > /dev/null; then
    hyprpaper &
    sleep 1
fi

wallpaper=$(find ~/Pictures/Wallpapers -type f -iname "*.jpg" -o -iname "*.png" | while read -r file; do echo -en "img:$file\n"; done | wofi -c ~/.config/wofi/wallpaper -s ~/.config/wofi/style-wallpaper.css --show dmenu --prompt "Set Wallpaper" -n)

if [ -n "$wallpaper" ]; then
    wallpaper=$(echo "$wallpaper" | sed 's/^img://')
    magick "$wallpaper" -crop 2560x1440+0+0 ~/.config/hypr/wallpaper/left.jpg
    magick "$wallpaper" -crop 2560x1440+2560+0 ~/.config/hypr/wallpaper/right.jpg
    
    hyprctl hyprpaper unload all
    hyprctl hyprpaper preload "~/.config/hypr/wallpaper/left.jpg"
    hyprctl hyprpaper preload "~/.config/hypr/wallpaper/right.jpg"
    hyprctl hyprpaper wallpaper "DP-2,~/.config/hypr/wallpaper/left.jpg"
    hyprctl hyprpaper wallpaper "DP-3,~/.config/hypr/wallpaper/right.jpg"
fi
